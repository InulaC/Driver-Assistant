# Vehicle Safety Alert System - Configuration
# This file contains all tunable parameters for the system

system:
  log_level: INFO
  log_file: telemetry.jsonl
  telemetry_flush_interval_s: 1.0

capture:
  resolution: [640, 480]
  target_fps: 15
  timeout_ms: 100
  reconnect_attempts: 3
  reconnect_interval_ms: 500

yolo:
  enabled: true                 # Set to false to disable YOLO detection entirely
  model_path: models/object.onnx
  input_size: [640, 640]
  confidence_threshold: 0.25
  iou_threshold: 0.45
  frame_skip: 5
  cache_ttl_ms: 500
  classes:
    - traffic_light
    - stop_sign
    - pedestrian
    - vehicle
    - animal

lane_detection:
  roi_top_ratio: 0.625
  hsv_white:
    h_min: 0
    h_max: 180
    s_min: 0
    s_max: 30
    v_min: 200
    v_max: 255
  hsv_yellow:
    h_min: 15
    h_max: 35
    s_min: 80
    s_max: 255
    v_min: 150
    v_max: 255
  gaussian_kernel: [5, 5]
  canny_low: 50
  canny_high: 150
  hough_rho: 2
  hough_theta_deg: 1
  hough_threshold: 50
  hough_min_length: 40
  hough_max_gap: 100
  slope_min: 0.5
  slope_max: 2.0
  min_line_length: 40
  ema_alpha: 0.3
  max_invalid_frames: 5

danger_zone:
  # Trapezoidal danger zone for collision detection
  # Narrower at top (farther), wider at bottom (closer)
  # Top edge - narrow, farther objects
  top_left_x: 0.40
  top_left_y: 0.78      # Start 78% down frame (shorter zone)
  top_right_x: 0.60
  top_right_y: 0.78     # Must match top_left_y!
  # Bottom edge - wider, closer objects  
  bottom_left_x: 0.25
  bottom_left_y: 1.0    # Stick to bottom
  bottom_right_x: 0.75
  bottom_right_y: 1.0

alerts:
  cooldown_ms: 300
  traffic_light_cooldown_ms: 25000  # Separate longer cooldown for traffic light alerts
  alert_hold_frames: 5  # How many frames to keep showing an alert on display
  sounds:
    collision: sounds/collision.wav
    lane_left: sounds/lane_left.wav
    lane_right: sounds/lane_right.wav
    traffic_light: sounds/traffic_light.wav
    stop_sign: sounds/stop_sign.wav
    animal: sounds/animal.wav
    system_warning: sounds/warning.wav

gpio:
  enabled: true
  buzzer_pin: 18

ir_sensor:
  enabled: false
  gpio_trigger: 23
  gpio_echo: 24
  poll_interval_ms: 100
  threshold_cm: 50

display:
  window_name: "Driver Assistant"
  overlay_alpha: 0.6
  bbox_thickness: 2
  lane_color: [0, 255, 0]
  danger_zone_color: [0, 0, 255]
  font_scale: 0.6

# Overtake Assistant - Advisory Only Module
# DISCLAIMER: This is NOT a safety system. Never rely on it for driving decisions.
overtake_assistant:
  enabled: true
  
  # Traffic side: "left" = drive on left side (overtake on RIGHT) - UK, Japan, India, Sri Lanka, etc.
  #               "right" = drive on right side (overtake on LEFT) - US, Europe, etc.
  traffic_side: "left"  # Change to "right" for right-hand traffic countries
  
  # Enable conditions - module stays DISABLED if not met
  min_lane_confidence: 0.3      # Minimum lane polynomial confidence (0.0-1.0)
  stability_frames: 3           # Frames of stable lanes before evaluation begins
  
  # Clearance zone geometry (area to left of our lane)
  zone_width_ratio: 1.0         # Zone width as ratio of our lane width
  zone_y_top_ratio: 0.65        # Top of zone as ratio of frame height
  
  # Safe determination - conservative defaults
  safe_frames_required: 5       # Consecutive safe frames required for SAFE status
  
  # Lane marking detection (broken vs solid line)
  # Mode options:
  #   "assume_broken" - Always assume broken line (overtaking allowed)
  #   "assume_solid"  - Always assume solid line (overtaking not allowed)
  #   "auto"          - Detect using image pixel analysis (recommended)
  line_detection_mode: "auto"
  broken_line_density_threshold: 0.5  # Legacy, not used in auto mode
  
  # Image-based line detection parameters (used when mode is "auto")
  intensity_threshold: 180      # Pixel brightness to consider as "lane marking" (0-255)
  min_gap_ratio: 0.15           # Minimum gap ratio to classify as broken (0.0-1.0)
  min_transitions: 2            # Minimum bright-to-dark transitions for broken line
  
  # Display colors (BGR format)
  zone_color_safe: [0, 255, 0]        # Green when SAFE
  zone_color_unsafe: [0, 165, 255]    # Orange when UNSAFE  
  zone_color_disabled: [128, 128, 128]  # Gray when DISABLED
  
  # Indicator position on screen
  indicator_position: [20, 100]
